# Настройка уведомлений (Email и Telegram)

Система поддерживает отправку уведомлений администраторам при регистрации новых пользователей (партнёров), ожидающих активации.

## Настройка Email уведомлений

### Для Gmail:

1. Включите двухфакторную аутентификацию в вашем Google аккаунте
2. Создайте пароль приложения:
   - Перейдите в [Настройки аккаунта Google](https://myaccount.google.com/)
   - Безопасность → Двухэтапная аутентификация → Пароли приложений
   - Создайте новый пароль приложения для "Почта" и "Другое устройство"
   - Скопируйте сгенерированный пароль (16 символов)

3. Добавьте переменные окружения в `.env` или `docker-compose.yml`:

```env
SMTP_ENABLED=true
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-16-char-app-password
SMTP_FROM_EMAIL=your-email@gmail.com
```

### Для других почтовых серверов:

Измените `SMTP_HOST` и `SMTP_PORT` в соответствии с настройками вашего почтового провайдера:
- Yandex: `smtp.yandex.ru:465` (SSL) или `smtp.yandex.ru:587` (TLS)
- Mail.ru: `smtp.mail.ru:465` (SSL) или `smtp.mail.ru:587` (TLS)
- Outlook: `smtp-mail.outlook.com:587` (TLS)

## Настройка Telegram уведомлений

### Шаг 1: Создание бота

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и задайте имя и username для бота
4. Скопируйте токен бота (выглядит как `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### Шаг 2: Получение Chat ID администраторов

Есть несколько способов:

**Способ 1: Через бота @userinfobot**
1. Найдите бота [@userinfobot](https://t.me/userinfobot) в Telegram
2. Начните диалог с ботом
3. Бот отправит ваш Chat ID (число, например `123456789`)

**Способ 2: Через вашего бота**
1. Отправьте любое сообщение вашему боту
2. Откройте в браузере: `https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates`
3. Найдите в ответе `"chat":{"id":123456789}` - это ваш Chat ID

### Шаг 3: Настройка переменных окружения

Добавьте в `.env` или `docker-compose.yml`:

```env
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_ADMIN_CHAT_IDS=123456789,987654321
```

**Важно:** 
- `TELEGRAM_ADMIN_CHAT_IDS` - список Chat ID через запятую без пробелов
- Каждый администратор должен сначала написать боту, чтобы бот мог отправлять ему сообщения

## Проверка работы

После настройки и перезапуска контейнера:

1. Создайте тестовое приглашение для партнёра
2. Партнёр должен принять приглашение и зарегистрироваться
3. Администраторы должны получить:
   - In-app уведомление в системе
   - Email уведомление (если настроено)
   - Telegram уведомление (если настроено)

## Отключение уведомлений

Чтобы отключить уведомления, установите:

```env
SMTP_ENABLED=false
TELEGRAM_BOT_TOKEN=
```

Или просто не указывайте эти переменные.

## Логирование

Ошибки отправки уведомлений логируются в:
- Email: `email` logger
- Telegram: `telegram` logger

Проверить логи можно через:
```bash
docker logs parfume-crm | grep -E "(email|telegram)"
```

