# Решение проблем с запуском

## Диагностика проблемы

Сначала запустите скрипт диагностики:

```bash
cd /opt/crm_parfume
sudo git pull origin main
chmod +x diagnose_server.sh
sudo ./diagnose_server.sh
```

Пришлите вывод скрипта для анализа.

## Частые проблемы и решения

### 1. Ошибка при сборке образа

```bash
# Проверьте логи сборки
sudo docker-compose build 2>&1 | tee build.log

# Или с полным выводом
sudo docker-compose build --progress=plain --no-cache
```

### 2. Контейнер не запускается

```bash
# Проверьте логи
sudo docker-compose logs crm --tail=100

# Проверьте статус
sudo docker-compose ps

# Попробуйте запустить вручную
sudo docker-compose up crm
```

### 3. Проблемы с правами доступа

```bash
# Проверьте права на директории
sudo ls -la ./data
sudo ls -la ./logs

# Исправьте права
sudo chown -R $(whoami):$(whoami) ./data ./logs
sudo chmod -R 755 ./data ./logs
```

### 4. Проблемы с портами

```bash
# Проверьте, не занят ли порт 8000
sudo netstat -tulpn | grep 8000
# или
sudo lsof -i :8000

# Если порт занят, измените в docker-compose.yml
```

### 5. Полная переустановка (если ничего не помогает)

```bash
# Остановите все контейнеры
sudo docker-compose down

# Удалите старые образы
sudo docker rmi crm_parfume_crm 2>/dev/null || true

# Очистите кэш Docker
sudo docker system prune -f

# Пересоберите с нуля
sudo docker-compose build --no-cache

# Запустите
sudo docker-compose up -d

# Проверьте логи
sudo docker-compose logs -f crm
```

## Проверка работоспособности

После запуска проверьте:

```bash
# 1. Статус контейнера
sudo docker-compose ps

# 2. Health check
curl http://localhost:8000/health

# 3. Логи
sudo docker-compose logs crm --tail=50
```

## Если проблема не решена

Пришлите:
1. Вывод `sudo ./diagnose_server.sh`
2. Вывод `sudo docker-compose logs crm --tail=100`
3. Вывод `sudo docker-compose build 2>&1 | tail -50`

