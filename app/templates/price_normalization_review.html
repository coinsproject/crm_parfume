{% extends "layout.html" %}
{% block title %}–†–µ–≤—å—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–π—Å–∞{% endblock %}
{% block page_title %}–†–µ–≤—å—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–π—Å–∞{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">–†–µ–≤—å—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–π—Å–∞</h1>
        <div class="d-flex gap-2">
            <a href="/price/search" class="btn btn-outline-secondary btn-sm">–ö –ø–æ–∏—Å–∫—É –ø—Ä–∞–π—Å–∞</a>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <form method="get" action="/normalization/review" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                    <select class="form-select" name="status_filter">
                        <option value="review" {% if status_filter == 'review' %}selected{% endif %}>–ù–∞ —Ä–µ–≤—å—é</option>
                        <option value="error" {% if status_filter == 'error' %}selected{% endif %}>–û—à–∏–±–∫–∏</option>
                        <option value="all" {% if status_filter == 'all' %}selected{% endif %}>–í—Å–µ (—Ä–µ–≤—å—é + –æ—à–∏–±–∫–∏)</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="mb-2">
                <span class="text-muted">–í—Å–µ–≥–æ: {{ total }} –∑–∞–ø–∏—Å–µ–π</span>
            </div>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ê—Ä—Ç–∏–∫—É–ª</th>
                            <th>–ò—Å—Ö–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                        <tr>
                            <td>{{ product.id }}</td>
                            <td><code>{{ product.external_article }}</code></td>
                            <td>
                                <div class="fw-semibold">{{ product.raw_name }}</div>
                                {% if product.normalization_notes %}
                                <div class="text-muted small">{{ product.normalization_notes }}</div>
                                {% endif %}
                            </td>
                            <td>
                                <div class="small">
                                    <div><strong>–ë—Ä–µ–Ω–¥:</strong> {{ product.norm_brand or '-' }} 
                                        {% if product.brand_confidence %}({{ "%.0f"|format(product.brand_confidence * 100) }}%){% endif %}
                                    </div>
                                    <div><strong>–ú–æ–¥–µ–ª—å:</strong> {{ product.model_name or '-' }}</div>
                                    {% if product.series %}
                                    <div><strong>–°–µ—Ä–∏—è:</strong> {{ product.series }}</div>
                                    {% endif %}
                                    {% if product.attrs_json %}
                                    {% set attrs = product.attrs_json|from_json %}
                                    {% if attrs and attrs.format %}
                                    <div><strong>–§–æ—Ä–º–∞—Ç:</strong> 
                                        <span class="badge bg-info">{{ attrs.format }}</span>
                                    </div>
                                    {% endif %}
                                    {% if attrs and attrs.volume_ml %}
                                    <div><strong>–û–±—ä—ë–º:</strong> {{ attrs.volume_ml }} –º–ª</div>
                                    {% endif %}
                                    {% if attrs and attrs.color %}
                                    <div><strong>–¶–≤–µ—Ç:</strong> {{ attrs.color }}</div>
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if product.ai_status == 'review' %}
                                <span class="badge bg-warning">–ù–∞ —Ä–µ–≤—å—é</span>
                                {% elif product.ai_status == 'error' %}
                                <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
                                {% else %}
                                <span class="badge bg-success">OK</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-primary" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#reviewModal{{ product.id }}">
                                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-info" 
                                            onclick="searchViaFragella({{ product.id }}, '{{ product.raw_name|e }}')"
                                            title="–ù–∞–π—Ç–∏ —á–µ—Ä–µ–∑ Fragella API">
                                        üîç Fragella
                                    </button>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Modal –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        <div class="modal fade" id="reviewModal{{ product.id }}" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <form method="post" action="/normalization/review/{{ product.id }}">
                                        <div class="modal-header">
                                            <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">–ò—Å—Ö–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                                                <div class="form-control-plaintext bg-light p-2 rounded">
                                                    {{ product.raw_name }}
                                                </div>
                                            </div>
                                            
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">–ë—Ä–µ–Ω–¥ *</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="norm_brand" 
                                                           id="norm_brand_{{ product.id }}"
                                                           value="{{ product.norm_brand or '' }}"
                                                           list="brands-list-{{ product.id }}"
                                                           required>
                                                    <datalist id="brands-list-{{ product.id }}">
                                                        {% for brand in brands %}
                                                        <option value="{{ brand.name_canonical }}">
                                                        {% endfor %}
                                                    </datalist>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –±—Ä–µ–Ω–¥–∞ (0-1)</label>
                                                    <input type="number" 
                                                           class="form-control" 
                                                           name="brand_confidence" 
                                                           value="{{ product.brand_confidence or '0.9' }}"
                                                           step="0.01" min="0" max="1">
                                                </div>
                                                <div class="col-md-12">
                                                    <label class="form-label">–ê–ª–∏–∞—Å (–∫–∞–∫ –≤ –ø—Ä–∞–π—Å–µ)</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="brand_alias" 
                                                           id="brand_alias_{{ product.id }}"
                                                           placeholder="–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ –º–æ–¥–µ–ª–∏"
                                                           data-raw-name="{{ product.raw_name|e }}">
                                                    <div class="form-text">–ê–ª–∏–∞—Å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –±—Ä–µ–Ω–¥–∞ –≤ –ø—Ä–∞–π—Å–µ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ –º–æ–¥–µ–ª–∏.</div>
                                                </div>
                                                <div class="col-md-12">
                                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ *</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="model_name" 
                                                           id="model_name_{{ product.id }}"
                                                           value="{{ product.model_name or '' }}"
                                                           oninput="updateBrandAlias({{ product.id }})"
                                                           required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">–°–µ—Ä–∏—è</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="series" 
                                                           value="{{ product.series or '' }}">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">–§–æ—Ä–º–∞—Ç</label>
                                                    <select class="form-select" name="format_value">
                                                        <option value="full" {% if not product.attrs_json or (product.attrs_json|from_json).get('format') == 'full' %}selected{% endif %}>Full</option>
                                                        <option value="tester" {% if product.attrs_json and (product.attrs_json|from_json).get('format') == 'tester' %}selected{% endif %}>Tester</option>
                                                        <option value="decant" {% if product.attrs_json and (product.attrs_json|from_json).get('format') == 'decant' %}selected{% endif %}>Decant</option>
                                                        <option value="sample" {% if product.attrs_json and (product.attrs_json|from_json).get('format') == 'sample' %}selected{% endif %}>Sample</option>
                                                        <option value="mini" {% if product.attrs_json and (product.attrs_json|from_json).get('format') == 'mini' %}selected{% endif %}>Mini</option>
                                                    </select>
                                                </div>
                                                {% if product.attrs_json %}
                                                {% set attrs = product.attrs_json|from_json %}
                                                <div class="col-md-6">
                                                    <label class="form-label">–û–±—ä—ë–º (–º–ª)</label>
                                                    <input type="number" 
                                                           class="form-control" 
                                                           name="volume_ml" 
                                                           value="{{ attrs.volume_ml or '' }}">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">–¶–≤–µ—Ç</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="color" 
                                                           value="{{ attrs.color or '' }}">
                                                </div>
                                                {% else %}
                                                <div class="col-md-6">
                                                    <label class="form-label">–û–±—ä—ë–º (–º–ª)</label>
                                                    <input type="number" 
                                                           class="form-control" 
                                                           name="volume_ml" 
                                                           value="">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">–¶–≤–µ—Ç</label>
                                                    <input type="text" 
                                                           class="form-control" 
                                                           name="color" 
                                                           value="">
                                                </div>
                                                {% endif %}
                                            </div>
                                            
                                            <div class="form-check mt-3">
                                                <input class="form-check-input" type="checkbox" name="create_alias" id="createAlias{{ product.id }}" value="1">
                                                <label class="form-check-label" for="createAlias{{ product.id }}">
                                                    –°–æ–∑–¥–∞—Ç—å –∞–ª–∏–∞—Å –±—Ä–µ–Ω–¥–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                </label>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% if products|length == 0 %}
                        <tr>
                            <td colspan="6" class="text-center text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ä–µ–≤—å—é</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            {% if pages > 1 %}
            <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è">
                <ul class="pagination mb-0">
                    {% set prev_page = page - 1 if page > 1 else 1 %}
                    {% set next_page = page + 1 if page < pages else pages %}
                    <li class="page-item {% if page == 1 %}disabled{% endif %}">
                        <a class="page-link" href="?page={{ prev_page }}&status_filter={{ status_filter }}">¬´</a>
                    </li>
                    <li class="page-item disabled"><span class="page-link">–°—Ç—Ä. {{ page }} –∏–∑ {{ pages }}</span></li>
                    <li class="page-item {% if page == pages %}disabled{% endif %}">
                        <a class="page-link" href="?page={{ next_page }}&status_filter={{ status_filter }}">¬ª</a>
                    </li>
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –≤ —à–∞–±–ª–æ–Ω–µ (–µ—Å–ª–∏ –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π)
function parseJson(str) {
    try {
        return JSON.parse(str);
    } catch (e) {
        return {};
    }
}

// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–ª–∏–∞—Å–∞ –±—Ä–µ–Ω–¥–∞
function updateBrandAlias(productId) {
    const modelInput = document.getElementById(`model_name_${productId}`);
    const aliasInput = document.getElementById(`brand_alias_${productId}`);
    if (!modelInput || !aliasInput) return;
    
    const rawNameInput = aliasInput.dataset.rawName;
    if (!rawNameInput) return;
    
    const modelName = modelInput.value.trim();
    const rawName = rawNameInput;
    
    // –ï—Å–ª–∏ –∞–ª–∏–∞—Å —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º
    if (aliasInput.value.trim() && aliasInput.dataset.manual === 'true') {
        return;
    }
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∞–ª–∏–∞—Å –∏–∑ raw_name
    let alias = extractBrandAlias(rawName, modelName);
    
    if (alias) {
        aliasInput.value = alias;
        aliasInput.dataset.manual = 'false';
    }
}

// –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–ª–∏–∞—Å–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–µ)
function extractBrandAlias(rawName, modelName) {
    if (!rawName) return "";
    
    rawName = rawName.trim();
    
    // –°—Ç–æ–ø-—Å–ª–æ–≤–∞
    const stopWords = new Set([
        '—É–Ω–∏—Å–µ–∫—Å', '–∂–µ–Ω—Å–∫', '–∂–µ–Ω—Å–∫–∏–π', '–º—É–∂—Å–∫', '–º—É–∂—Å–∫–æ–π',
        '–ø–∞—Ä—Ñ', '–ø–∞—Ä—Ñ—é–º–µ—Ä–Ω–∞—è', '—Ç—É–∞–ª–µ—Ç', '—Ç—É–∞–ª–µ—Ç–Ω–∞—è', '–≤–æ–¥–∞',
        '–º–ª', 'ml', '–≥', '–≥—Ä', 'g', 'gr',
        '—Ç–µ—Å—Ç–µ—Ä', '(—Ç–µ—Å—Ç–µ—Ä)', '–æ—Ç–ª–∏–≤–∞–Ω—Ç', '–ø—Ä–æ–±–Ω–∏–∫', 'sample',
        '–¥—É—Ö–∏', 'edp', 'edt', 'eau', 'de', 'parfum', 'toilette',
        '–º–∏–Ω–∏–∞—Ç—é—Ä–∞', 'mini', 'decant', 'for', 'women', 'men'
    ]);
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å > ‚Üí –≤—Å—ë –¥–æ –ø–µ—Ä–≤–æ–≥–æ >
    if (rawName.includes('>')) {
        const parts = rawName.split('>', 1);
        const candidate = parts[0].trim();
        if (candidate) {
            return candidate;
        }
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å modelName, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ rawName
    if (modelName && modelName.trim()) {
        const modelLower = modelName.trim().toLowerCase();
        const rawLower = rawName.toLowerCase();
        
        const modelPos = rawLower.indexOf(modelLower);
        if (modelPos > 0) {
            let candidate = rawName.substring(0, modelPos).trim();
            // –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∫–æ–Ω—Ü–µ
            candidate = candidate.replace(/[^\w&\-\.\s]+$/, '').trim();
            if (candidate && candidate.length >= 2) {
                return candidate;
            }
        }
    }
    
    // –ò–Ω–∞—á–µ –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 2-5 —Å–ª–æ–≤ –¥–æ —Å—Ç–æ–ø-—Å–ª–æ–≤
    const words = rawName.split();
    let stopPos = null;
    
    for (let i = 0; i < words.length; i++) {
        const wordLower = words[i].toLowerCase().replace(/[.,;:()\[\]{}]/g, '');
        if (stopWords.has(wordLower)) {
            stopPos = i;
            break;
        }
    }
    
    let maxWords;
    if (stopPos !== null) {
        maxWords = Math.min(5, stopPos);
    } else {
        maxWords = Math.min(5, words.length);
    }
    
    // –ú–∏–Ω–∏–º—É–º 2 —Å–ª–æ–≤–∞ –¥–ª—è –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤
    if (maxWords < 2) {
        maxWords = Math.min(2, words.length);
    }
    
    if (maxWords === 0) {
        return "";
    }
    
    const candidateWords = words.slice(0, maxWords);
    let candidate = candidateWords.join(' ').trim();
    
    // –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
    candidate = candidate.replace(/^[^\w&\-\.]+|[^\w&\-\.]+$/g, '');
    
    return candidate && candidate.length >= 2 ? candidate : "";
}

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–∏–∞—Å–∞
document.addEventListener('DOMContentLoaded', function() {
    // –î–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –∞–ª–∏–∞—Å–∞
    document.querySelectorAll('input[name="brand_alias"]').forEach(function(input) {
        input.addEventListener('input', function() {
            this.dataset.manual = 'true';
        });
    });
});

// –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Fragella API
async function searchViaFragella(productId, rawName) {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '–ü–æ–∏—Å–∫...';
    
    try {
        const response = await fetch(`/normalization/search-fragella/${productId}`);
        const data = await response.json();
        
        if (data.success && data.data) {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            const modal = new bootstrap.Modal(document.getElementById(`reviewModal${productId}`));
            modal.show();
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            const form = document.querySelector(`#reviewModal${productId} form`);
            if (form) {
                const brandInput = form.querySelector('input[name="norm_brand"]');
                const modelInput = form.querySelector('input[name="model_name"]');
                const genderSelect = form.querySelector('select[name="gender"]');
                
                if (brandInput && data.data.brand) {
                    brandInput.value = data.data.brand;
                }
                if (modelInput && data.data.model_name) {
                    modelInput.value = data.data.model_name;
                }
                if (genderSelect && data.data.gender) {
                    genderSelect.value = data.data.gender;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                if (data.data.all_results && data.data.all_results.length > 1) {
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'alert alert-info mt-2';
                    infoDiv.innerHTML = `<strong>–ù–∞–π–¥–µ–Ω–æ ${data.data.all_results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong><br>` +
                        data.data.all_results.map((r, i) => 
                            `${i+1}. ${r.Brand || r.brand || ''} ${r.Name || r.name || ''}`
                        ).join('<br>');
                    form.querySelector('.modal-body').appendChild(infoDiv);
                }
            }
            
            alert('–î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã —á–µ—Ä–µ–∑ Fragella –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ —Ñ–æ—Ä–º—É!');
        } else {
            const errorMsg = data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
            console.error('Fragella search failed:', data);
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ Fragella:\n' + errorMsg);
        }
    } catch (error) {
        console.error('Fragella search error:', error);
        let errorMsg = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
        if (error instanceof TypeError && error.message.includes('fetch')) {
            errorMsg = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É';
        } else if (error.message) {
            errorMsg = error.message;
        }
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ Fragella:\n' + errorMsg);
    } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}
</script>
{% endblock %}

